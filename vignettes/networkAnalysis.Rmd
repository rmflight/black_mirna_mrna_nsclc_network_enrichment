# Network Analysis

```{r setup}
library(STRINGdb)
library(graph)
library(RCytoscape)
library(org.Hs.eg.db)
library(hgu133plus2.db)

stringFileLoc <- "/mlab/data/rmflight/Documents/stringdatabase_91/"
```


# First question

* Which of the 13 that map to STRING, which ones map to AKT(??) and EGFR pathway? 
* any other pathways?

## Data

mRNA and miRNA from NSCLC cell lines with differential response to erolotinib (EGFR inhibitor). Affy U133 2.0, miRNA TaqMan card.

After reading in the data, what are our options?

* Use *STRINGdb* to get PPI (definite)
* Use *reactomedb* to get pathway membership (and consider co-occurence in pathway as an edge)
* Use *KEGGREST* and *KEGGGraph* to get pathway links between genes

stringdb - http://www.bioconductor.org/packages/release/bioc/vignettes/STRINGdb/inst/doc/STRINGdb.pdf
reactomedb

LOO cross-validated PLS results giving interactions between miRNA and mRNA.

```{r loadData}
mirData <- read.table("compiledinteractiondata.csv", header=TRUE, stringsAsFactors=FALSE, sep=",")
newmRNA <- sapply(seq(1, nrow(mirData)), function(x){
  useID <- mirData$mRNA[x]
  nID <- nchar(useID)
  substring(useID, 2, nID)
})
mirData$mRNA <- newmRNA
```

What is the distribution of associations of miRNA's to mRNA from the PLS results?

```{r linkDistribution}
splitMRNA <- split(mirData$miRNA, mirData$mRNA)
splitCount <- sapply(splitMRNA, length)
hist(splitCount)
```

Based on this (and comments from P Black), we will restrict our analysis to those Affy probesets with at least **5** miRNA associations.

```{r filterMRNA}
nMin <- 5
sum(splitCount >= nMin)

useMRNA <- data.frame(gene=names(splitCount)[splitCount >= nMin], stringsAsFactors=FALSE)
```



```{r}

```



```{r setupSTRINGdb}
string_db <- STRINGdb$new(version="9_1", species=9606)
```

```{r translate2String}
useMRNA_mapped <- string_db$map(useMRNA, "gene", removeUnmappedRows=TRUE)
useMRNA_mapped$Symbol <- unlist(mget(useMRNA_mapped$gene, hgu133plus2SYMBOL, ifnotfound=NA))
mrnaNeighbors <- string_db$get_neighbors(useMRNA_mapped$STRING_id)

allProteins <- unique(c(useMRNA_mapped$STRING_id, mrnaNeighbors))
allInteractions <- string_db$get_interactions(allProteins)

keepInt <- (allInteractions$coexpression > 0) & (allInteractions$experimental > 0) & 

allInteractions <- allInteractions[keepInt,]
```

Now that we have a set of filtered interactions, we can examine the network and see what is going on.

```{r genNetwork}
intGraph <- graphNEL(nodes=unique(c(allInteractions$from, allInteractions$to)), edgemode="directed")

intGraph <- addEdge(allInteractions$from, allInteractions$to, intGraph)
```

```{r translateID}
stringID <- nodes(intGraph)
enspID <- substr(stringID, 6, 20)
entrID <- unlist(mget(enspID, org.Hs.egENSEMBLPROT2EG, ifnotfound=NA))
symbolID <- sapply(entrID, function(x){
  if (!is.na(x)){
    unlist(mget(x, org.Hs.egSYMBOL, ifnotfound=NA))
  } else {
    NA
  }
})
symbolID <- unlist(symbolID, use.names=FALSE)
nameID <- sapply(entrID, function(x){
  if (!is.na(x)){
    unlist(mget(x, org.Hs.egGENENAME, ifnotfound=NA))
  } else {
    NA
  }
})
```

