# Network Analysis

```{r setup}
library(STRINGdb)
library(graph)
library(RCytoscape)
library(org.Hs.eg.db)
library(hgu133plus2.db)

stringFileLoc <- "/mlab/data/rmflight/Documents/stringdatabase_91/"
```


# First question

* Which of the 13 that map to STRING, which ones map to AKT(??) and EGFR pathway? 
* any other pathways?

## Data

mRNA and miRNA from NSCLC cell lines with differential response to erolotinib (EGFR inhibitor). Affy U133 2.0, miRNA TaqMan card.

After reading in the data, what are our options?

* Use *STRINGdb* to get PPI (definite)
* Use *reactomedb* to get pathway membership (and consider co-occurence in pathway as an edge)
* Use *KEGGREST* and *KEGGGraph* to get pathway links between genes

stringdb - http://www.bioconductor.org/packages/release/bioc/vignettes/STRINGdb/inst/doc/STRINGdb.pdf
reactomedb

LOO cross-validated PLS results giving interactions between miRNA and mRNA.

```{r loadData}
mirData <- read.table("compiledinteractiondata.csv", header=TRUE, stringsAsFactors=FALSE, sep=",")
newmRNA <- sapply(seq(1, nrow(mirData)), function(x){
  useID <- mirData$mRNA[x]
  nID <- nchar(useID)
  substring(useID, 2, nID)
})
mirData$mRNA <- newmRNA
```

What is the distribution of associations of miRNA's to mRNA from the PLS results?

```{r linkDistribution}
splitMRNA <- split(mirData$miRNA, mirData$mRNA)
splitCount <- sapply(splitMRNA, length)
hist(splitCount)
```

Based on this (and comments from P Black), we will restrict our analysis to those Affy probesets with at least **5** miRNA associations.

```{r filterMRNA}
nMin <- 5
sum(splitCount >= nMin)

useMRNA <- data.frame(gene=names(splitCount)[splitCount >= nMin], stringsAsFactors=FALSE)
```

We want to convert our *Affy* ID's to other gene symbols and names for further use.

```{r convertID}
outMRNA <- select(hgu133plus2.db, useMRNA$gene, c("SYMBOL", "GENENAME", "ENTREZID"), "PROBEID")
```

Because we don't have direct access to STRING's translations, lets use a STRINGdb instance to do mapping of SYMBOLs to STRING IDs.

```{r setupSTRINGdb}
string_db <- STRINGdb$new(version="9_1", species=9606, input_directory=stringFileLoc)
outMRNA_mapped <- string_db$map(outMRNA, "SYMBOL", removeUnmappedRows=TRUE)
```

We've previously downloaded the STRINGdb files for human. Let's load them up and parse them down.

```{r stringData}
stringData <- read.table(file.path(stringFileLoc, "9606.protein.links.detailed.v9.1.txt"), header=TRUE, sep=" ", stringsAsFactors=FALSE)
head(stringData)
```

We will use the cutoff for `combined_score` of 400 (the default in STRING itself), and then filter down to just those things with co-expression, experimental or database evidence.

```{r filterData}
combScore <- 400
minScores <- c(experimental=1, database=1, coexpression=1)
passesScore <- rep(FALSE, nrow(stringData))
invisible(lapply(names(minScores), function(evidence){
  passesScore <<- passesScore & (stringData[, evidence] >= minScores[evidence])
}))
head(stringData[passesScore,])
```

```{r trueFilter}
stringData <- stringData[passesScore,]
```

Now that we have possible interactions, we need to filter them down to links that involve our actual proteins of interest.

```{r getUsefulLinks}
rnd1 <- which((stringData$protein1 %in% outMRNA_mapped$STRING_id) | (stringData$protein2 %in% outMRNA_mapped$STRING_id))
rnd1_ID <- c(stringData$protein1[rnd1], stringData$protein2[rnd1])
```

